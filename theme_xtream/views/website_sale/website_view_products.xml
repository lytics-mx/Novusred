<odoo>
    <template id="website_view_product_xtream" inherit_id="website_sale.product">
        <xpath expr="//div[@id='wrap']" position="replace">
            
            <t t-call-assets="website.assets_frontend" t-js="true"/>
            <t t-call-assets="website_sale.assets_frontend" t-js="true"/>
            <div id="wrap" class="oe_structure oe_website_sale text-center" style="padding: 40px;">
                           <!-- ...existing code... -->
            <div style="background:#D2D2D2; padding:10px 20px; border-radius:6px; margin-bottom:20px; display:flex; align-items:center; gap:10px; justify-content:flex-start;">
                <t t-set="referer" t-value="request.httprequest.headers.get('Referer')"/>
                <t t-if="not referer or referer == request.httprequest.url">
                    <t t-set="referer" t-value="'/subcategory'"/>
                </t>
                <a t-att-href="referer" style="color:#333;">Volver</a>
                <span style="margin: 0 8px;">|</span>
                <span t-if="categories">
                    <span t-foreach="categories" t-as="cat">
                        <t t-if="cat != categories[0]"> &gt; </t>
                        <a t-att-href="'/shop/category/%s' % cat.id" t-esc="cat.name" style="color:#337ab7;"/>
                    </span>
                </span>
            </div>

            <!-- ...resto del contenido (imagen, nombre, etc)... -->
            <div class="row">
                <!-- Galería de miniaturas a la izquierda -->
                <div class="col-2 d-none d-md-block">
                    <div class="d-flex flex-column gap-2 align-items-center" id="product-thumbs">
                        <!-- Siempre la imagen principal como primer miniatura -->
                        <img t-att-src="'/web/image/product.template/' + str(product.id) + '/image_1920'"
                            class="img-thumbnail mb-2 product-thumb active thumb-mini"
                            t-att-data-img="'/web/image/product.template/' + str(product.id) + '/image_1920'"
                            style="cursor:pointer;" />
                    
                        <!-- Después, solo las imágenes adicionales -->
                        <t t-if="product.product_image_ids">
                            <t t-foreach="product.product_image_ids" t-as="img">
                                <img t-att-src="'/web/image/product.image/' + str(img.id) + '/image_1920'"
                                    class="img-thumbnail mb-2 product-thumb thumb-mini"
                                    t-att-data-img="'/web/image/product.image/' + str(img.id) + '/image_1920'"
                                    style="cursor:pointer;" />
                            </t>
                        </t>
                    </div>
                </div>
                <!-- Imagen principal al centro -->
                <div class="col-12 col-md-6 text-center d-flex align-items-center justify-content-center">
                    <img id="main-product-img"
                        t-att-src="'/web/image/product.template/' + str(product.id) + '/image_1920'"
                        class="img-fluid main-img-large"
                        style="max-height:580px;cursor:pointer;"/>
                </div>
                <script type="text/javascript">
                    document.addEventListener('DOMContentLoaded', function() {
                        var mainImg = document.getElementById('main-product-img');
                        var thumbs = document.querySelectorAll('#product-thumbs .product-thumb');
                        // Cambiar imagen principal al hacer click en miniatura
                        thumbs.forEach(function(thumb) {
                            thumb.addEventListener('click', function() {
                                mainImg.src = thumb.getAttribute('data-img');
                                thumbs.forEach(function(t) { t.classList.remove('active'); });
                                thumb.classList.add('active');
                            });
                        });
                        // Al hacer click en la imagen principal, vuelve a la primera miniatura
                        mainImg.addEventListener('click', function() {
                            var firstThumb = document.querySelector('#product-thumbs .product-thumb');
                            if (firstThumb) {
                                mainImg.src = firstThumb.getAttribute('data-img');
                                thumbs.forEach(function(t) { t.classList.remove('active'); });
                                firstThumb.classList.add('active');
                            }
                        });
                    });
                </script>
                    <!-- Información del producto a la derecha (solo texto, sin lógica) -->
                    <div class="col-12 col-md-4">
                        <div class="card p-3" style="border-radius:12px;">
                            <!-- Nombre del producto -->
                            <h2 t-esc="product.name" style="font-size:1.2em; font-weight:600; margin-bottom:8px;"></h2>
                            
                            <!-- Precios y descuentos -->
                            <div>
                                <t t-if="fixed_discount">
                                    <span style="text-decoration:line-through; color:#888; font-size:1em;">
                                        <t t-esc="product.list_price"/>
                                    </span>
                                </t>
                                <span style="color:#00a650; font-size:2em; font-weight:700;">
                                    <t t-esc="discounted_price"/>
                                </span>
                                <t t-if="fixed_discount">
                                    <span style="color:#f00; font-size:1em; font-weight:600; margin-left:8px;">
                                        <t t-esc="str(discount_percentage) + '% OFF'"/>
                                    </span>
                                </t>
                            </div>
                            <!-- Muestra el ahorro solo si hay descuento -->
                            <t t-if="fixed_discount">
                                <div style="color:#00a650;">
                                    <t t-esc="'Ahorra ' + str(fixed_discount) + ' MXN'"/>
                                </div>
                            </t>
                            <!-- Envío gratis -->
                            <t t-if="product.free_shipping">
                                <div style="color:#f00; font-weight:600;">Envío gratis</div>
                            </t>
                            <!-- Oferta del día -->
                            <t t-if="product.product_tag_ids">
                                <div style="background:#e0eaff; display:inline-block; padding:2px 8px; border-radius:4px; margin:6px 0;">OFERTA DEL DÍA</div>
                            </t>
                            <!-- Stock -->
                            <div>En Stock: <t t-esc="product.qty_available"/> artículos</div>
                            <!-- Marca -->
                            <div>
                                Marca: <t t-esc="product.brand_type_id.name"/>
                            </div>
                            <!-- Modelo -->
                            <div>
                                Modelo: <t t-esc="product.default_code"/>
                            </div>
                            <!-- Cantidad -->

                            <div class="mt-3">
                                <div class="js_product">
                                    <!-- Input de cantidad único -->
                                    <input id="qty-input" type="number" name="add_qty" value="1" min="1" class="form-control text-center mb-2" style="width: 60px; display:inline-block;"/>
                                    <!-- Botón Agregar al carrito -->
                                    <form id="add-to-cart-form" action="/shop/cart/update" method="POST" class="js_website_sale d-inline">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" t-nocache="The csrf token must always be up to date."/>
                                        <input type="hidden" name="product_id" t-att-value="product.product_variant_id.id"/>
                                        <input type="hidden" name="add_qty" id="cart-qty"/>
                                        <button type="submit" class="btn btn-primary js_add_cart_json">
                                            Agregar al carrito
                                        </button>
                                    </form>
                                    <!-- Botón Comprar -->
                                    <form id="buy-now-form" action="/shop/cart/update" method="POST" class="d-inline">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" t-nocache="The csrf token must always be up to date."/>
                                        <input type="hidden" name="product_id" t-att-value="product.product_variant_id.id"/>
                                        <input type="hidden" name="add_qty" id="buy-qty"/>
                                        <button type="submit" class="btn btn-outline-primary btn-block" id="buy-now-btn">Comprar</button>
                                    </form>
                                </div>
                                <script type="text/javascript">
                                    document.addEventListener('DOMContentLoaded', function() {
                                        var qtyInput = document.getElementById('qty-input');
                                        var cartQty = document.getElementById('cart-qty');
                                        var buyQty = document.getElementById('buy-qty');
                                        var cartForm = document.getElementById('add-to-cart-form');
                                        var buyForm = document.getElementById('buy-now-form');
                            
                                        // Al enviar el formulario de carrito
                                        cartForm.addEventListener('submit', function(e) {
                                            cartQty.value = qtyInput.value;
                                        });
                            
                                        // Al enviar el formulario de comprar
                                        buyForm.addEventListener('submit', function(e) {
                                            e.preventDefault();
                                            buyQty.value = qtyInput.value;
                                            var data = new FormData(buyForm);
                                            fetch(buyForm.action, {
                                                method: 'POST',
                                                body: data,
                                                credentials: 'same-origin'
                                            })
                                            .then(response => {
                                                if (response.ok) {
                                                    window.location.href = '/shop/checkout?try_skip_step=true';
                                                }
                                            });
                                        });
                                    });
                                </script>
                            </div>
                            </div>
                    </div>
                </div>
            </div> <!-- Cierre de la fila .row -->

            <div id="product_option_block"></div>
            <div id="o_product_terms_and_share"></div>
            
            <t t-jquery="body" t-operation="append">
                <!-- <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        var form = document.getElementById('add-to-cart-form');
                        if (form) {
                            form.addEventListener('submit', function(e) {
                                e.preventDefault();
                                var data = new FormData(form);
                                fetch(form.action, {
                                    method: 'POST',
                                    body: data,
                                    credentials: 'same-origin'
                                })
                                .then(response => {
                                    if (response.ok) {
                                        // Redirige al carrito
                                        window.location.href = '/shop/cart';
                                    }
                                });
                            });
                        }
                    });
                </script> -->
                <style>
                    .product-thumb.thumb-mini {
                        width: 60px;
                        height: 60px;
                        object-fit: cover;
                        border-radius: 6px;
                    }
                    .main-img-large {
                        max-width: 100%;
                        max-height: 350px;
                        border-radius: 8px;
                        /* box-shadow: 0 2px 8px rgba(0,0,0,0.08); */ /* Eliminado el sombreado */
                    }
                    .product-thumb.active {
                        border: 2px solid #4285f4;
                    }
                </style>
            </t>

        </xpath>
    </template>
</odoo>