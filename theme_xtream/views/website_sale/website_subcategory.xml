<odoo>
    <template id="website_subcategory" name="Subcategorías con Filtros">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty" style="font-family: 'Questrial', sans-serif;">
            <div class="container mt-4">
                    <div class="row">
                            <!-- Header con breadcrumb y ordenamiento -->
                            
                            <div class="products-header mb-4">
                                <div class="row align-items-center">
                                    <!-- Breadcrumb -->
                                    <div class="col-md-8">
                                        <nav aria-label="breadcrumb">
                                            <ol class="breadcrumb mb-0">
                                                <li class="breadcrumb-item">
                                                    <a href="/subcategory">Todas las categorías</a>
                                                </li>
                                                <t t-if="selected_category">
                                                    <li class="breadcrumb-item">
                                                        <a t-att-href="'/subcategory?category_id=' + str(selected_category.id)">
                                                            <t t-esc="selected_category.name"/>
                                                        </a>
                                                    </li>
                                                </t>
                                                <t t-if="selected_subcategory">
                                                    <li class="breadcrumb-item active" aria-current="page">
                                                        <t t-esc="selected_subcategory.name"/>
                                                    </li>
                                                </t>
                                                <t t-if="selected_brand">
                                                    <li class="breadcrumb-item active" aria-current="page">
                                                        <t t-esc="selected_brand.name"/>
                                                    </li>
                                                </t>
                                            </ol>
                                        </nav>
                                    </div>
                                    
                                    <!-- Ordenamiento -->
                                    <div class="col-md-4 text-end">
                                        <div class="d-flex align-items-center justify-content-end">
                                            <label for="sort-select" class="form-label me-2 mb-0 small">Ordenar por:</label>
                                            <select id="sort-select" class="form-select form-select-sm" style="width: auto;" onchange="updateSort()">
                                                <option value="relevance" t-att-selected="'selected' if current_filters.get('sort') == 'relevance' or not current_filters.get('sort') else ''">Más relevante</option>
                                                <option value="newest" t-att-selected="'selected' if current_filters.get('sort') == 'newest' else ''">Más reciente</option>
                                                <option value="best_sellers" t-att-selected="'selected' if current_filters.get('sort') == 'best_sellers' else ''">Más vendidos</option>
                                                <option value="offers" t-att-selected="'selected' if current_filters.get('sort') == 'offers' else ''">Ofertas</option>
                                                <option value="price_low" t-att-selected="'selected' if current_filters.get('sort') == 'price_low' else ''">Precio: menor a mayor</option>
                                                <option value="price_high" t-att-selected="'selected' if current_filters.get('sort') == 'price_high' else ''">Precio: mayor a menor</option>
                                                <option value="alphabetical" t-att-selected="'selected' if current_filters.get('sort') == 'alphabetical' else ''">A-Z</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        <!-- Sidebar de Filtros -->
                        <div class="col-lg-3 col-md-4">
                            <div class="filters-sidebar" style="padding: 20px;">
                                <!-- Product Count -->
                                <div class="filter-section mb-4">
                                    <div class="d-flex flex-column">
                                        <h4 class="mb-1">
                                            <t t-if="selected_subcategory">
                                                <t t-esc="selected_subcategory.name"/>
                                            </t>
                                            <t t-elif="selected_category">
                                                <t t-esc="selected_category.name"/>
                                            </t>
                                            <t t-else="">
                                                Todos los productos
                                            </t>
                                        </h4>
                                        <span class="text-muted small">
                                            <t t-esc="product_count"/> productos
                                        </span>
                                    </div>
                                </div>

                                <!-- Categorías -->
                                <div class="filter-section mb-4">
                                    <!-- <h6 class="mb-2">Categoría</h6>
                                    <select id="category-select" class="form-select form-select-sm mb-2" onchange="updateFilters()">
                                        <option value="">Todas las categorías</option>
                                        <t t-foreach="categories" t-as="category" t-key="category.id">
                                            <option t-att-value="category.id" 
                                                    t-att-selected="'selected' if current_filters.get('category_id') == category.id else ''">
                                                <t t-esc="category.name"/>
                                            </option>
                                        </t>
                                    </select> -->
                                    
                                    <!-- Subcategorías -->
                                    <select id="subcategory-select" class="form-select form-select-sm" onchange="updateFilters()" 
                                            t-att-style="'display: block' if subcategories else 'display: none'">
                                        <option value="">Todas las subcategorías</option>
                                        <t t-foreach="subcategories" t-as="subcategory" t-key="subcategory.id">
                                            <option t-att-value="subcategory.id"
                                                    t-att-selected="'selected' if current_filters.get('subcategory_id') == subcategory.id else ''">
                                                <t t-esc="subcategory.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </div>

                                <!-- Free Shipping Toggle -->
                                <!-- Free Shipping Toggle -->
                                <div class="mb-3 p-3 border rounded-3 bg-white">
                                    <h5 class="text-orange fw-bold" style="color: #FF5207; font-size: 16px; font-style: italic; background-color: white;">Envío gratis</h5>

                                    <div class="form-check form-switch bg-white">
                                        <input class="form-check-input" type="checkbox" id="freeShippingToggle"
                                            t-att-checked="'checked' if str(current_filters.get('free_shipping', '')).lower() == 'true' else None" />
                                        <label class="form-check-label" for="freeShippingToggle" style="background-color: white;">
                                            Solo productos con envío gratis
                                        </label>
                                    </div>
                                </div>
                                <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    var toggle = document.getElementById('freeShippingToggle');
                                    if (toggle) {
                                        // Establecer el estado inicial del checkbox basado en current_filters
                                        var currentFreeShipping = '<t t-esc="str(current_filters.get(&apos;free_shipping&apos;) or &apos;&apos;).lower()"/>';
                                        toggle.checked = (currentFreeShipping === 'true');
                                        
                                        toggle.addEventListener('change', function() {
                                            // Obtener parámetros actuales de la URL
                                            var urlParams = new URLSearchParams(window.location.search);
                                            
                                            // Mantener todos los filtros existentes
                                            var newUrl = '/subcategory?';
                                            var params = [];
                                            
                                            // Mantener categoría
                                            if (urlParams.get('category_id')) {
                                                params.push('category_id=' + urlParams.get('category_id'));
                                            }
                                            
                                            // Mantener subcategoría
                                            if (urlParams.get('subcategory_id')) {
                                                params.push('subcategory_id=' + urlParams.get('subcategory_id'));
                                            }
                                            
                                            // Mantener marca
                                            if (urlParams.get('brand_id')) {
                                                params.push('brand_id=' + urlParams.get('brand_id'));
                                            }
                                            
                                            // Mantener rango de precio
                                            if (urlParams.get('price_range')) {
                                                params.push('price_range=' + urlParams.get('price_range'));
                                            }
                                            
                                            // Mantener descuento
                                            if (urlParams.get('discount_id')) {
                                                params.push('discount_id=' + urlParams.get('discount_id'));
                                            }
                                            
                                            // Mantener promoción
                                            if (urlParams.get('promotion_id')) {
                                                params.push('promotion_id=' + urlParams.get('promotion_id'));
                                            }
                                            
                                            // Mantener ordenamiento
                                            if (urlParams.get('sort')) {
                                                params.push('sort=' + urlParams.get('sort'));
                                            }
                                            
                                            // Agregar envío gratis solo si está marcado
                                            if (this.checked) {
                                                params.push('free_shipping=true');
                                            }
                                            
                                            // Construir URL final
                                            if (params.length > 0) {
                                                newUrl += params.join('&amp;');
                                            } else {
                                                newUrl = '/subcategory';
                                            }
                                            
                                            console.log('Redirecting to:', newUrl);
                                            window.location.href = newUrl;
                                        });
                                    }
                                });
                                </script>

                                <!-- Brands (Marca) -->
                                <div class="filter-section mb-4" t-if="available_brands">
                                    <h6 class="mb-2">Marca</h6>
                                    <div class="brands-list">
                                        <t t-foreach="available_brands" t-as="brand" t-key="brand.id">
                                            <div class="mb-1">
                                                <a t-att-href="'/subcategory?' + (current_filters.get('category_id') and ('category_id=' + str(current_filters.get('category_id')) + '&amp;') or '') + (current_filters.get('subcategory_id') and ('subcategory_id=' + str(current_filters.get('subcategory_id')) + '&amp;') or '') + (current_filters.get('free_shipping') and 'free_shipping=true&amp;' or '') + 'brand_id=' + str(brand.id)" 
                                                   class="text-decoration-none small"
                                                   t-att-style="'color: #007bff; font-weight: bold;' if current_filters.get('brand_id') == brand.id else 'color: #6c757d;'">
                                                    <t t-esc="brand.name"/>
                                                    (<t t-esc="brand_counts.get(brand.id, 0)"/>)
                                                </a>
                                            </div>
                                        </t>
                                    </div>
                                </div>

                                <!-- Price Range -->
                                <div class="filter-section mb-4">
                                    <h6 class="mb-2">Precio</h6>
                                    <div class="price-options">
                                        <div class="mb-1">
                                            <a t-att-href="'/subcategory?' + (current_filters.get('category_id') and ('category_id=' + str(current_filters.get('category_id')) + '&amp;') or '') + (current_filters.get('subcategory_id') and ('subcategory_id=' + str(current_filters.get('subcategory_id')) + '&amp;') or '') + (current_filters.get('brand_id') and ('brand_id=' + str(current_filters.get('brand_id')) + '&amp;') or '') + (current_filters.get('free_shipping') and 'free_shipping=true&amp;' or '') + 'price_range=0_500'" 
                                               class="text-decoration-none small"
                                               t-att-style="'color: #007bff; font-weight: bold;' if current_filters.get('price_range') == '0_500' else 'color: #6c757d;'">
                                                Hasta $500 (<t t-esc="price_ranges.get('0_500', 0)"/>)
                                            </a>
                                        </div>
                                        <div class="mb-1">
                                            <a t-att-href="'/subcategory?' + (current_filters.get('category_id') and ('category_id=' + str(current_filters.get('category_id')) + '&amp;') or '') + (current_filters.get('subcategory_id') and ('subcategory_id=' + str(current_filters.get('subcategory_id')) + '&amp;') or '') + (current_filters.get('brand_id') and ('brand_id=' + str(current_filters.get('brand_id')) + '&amp;') or '') + (current_filters.get('free_shipping') and 'free_shipping=true&amp;' or '') + 'price_range=500_1000'" 
                                               class="text-decoration-none small"
                                               t-att-style="'color: #007bff; font-weight: bold;' if current_filters.get('price_range') == '500_1000' else 'color: #6c757d;'">
                                                De $500 a $1000 (<t t-esc="price_ranges.get('500_1000', 0)"/>)
                                            </a>
                                        </div>
                                        <div class="mb-1">
                                            <a t-att-href="'/subcategory?' + (current_filters.get('category_id') and ('category_id=' + str(current_filters.get('category_id')) + '&amp;') or '') + (current_filters.get('subcategory_id') and ('subcategory_id=' + str(current_filters.get('subcategory_id')) + '&amp;') or '') + (current_filters.get('brand_id') and ('brand_id=' + str(current_filters.get('brand_id')) + '&amp;') or '') + (current_filters.get('free_shipping') and 'free_shipping=true&amp;' or '') + 'price_range=1000_plus'" 
                                               class="text-decoration-none small"
                                               t-att-style="'color: #007bff; font-weight: bold;' if current_filters.get('price_range') == '1000_plus' else 'color: #6c757d;'">
                                                Más de $1000 (<t t-esc="price_ranges.get('1000_plus', 0)"/>)
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Discounts -->
                                <div class="filter-section mb-4" t-if="discount_tags">
                                    <h6 class="mb-2">Descuentos</h6>
                                    <div class="discount-options">
                                        <t t-foreach="discount_tags" t-as="tag" t-key="tag.id">
                                            <div class="mb-1">
                                                <a t-att-href="'/subcategory?' + (current_filters.get('category_id') and ('category_id=' + str(current_filters.get('category_id')) + '&amp;') or '') + (current_filters.get('subcategory_id') and ('subcategory_id=' + str(current_filters.get('subcategory_id')) + '&amp;') or '') + (current_filters.get('brand_id') and ('brand_id=' + str(current_filters.get('brand_id')) + '&amp;') or '') + (current_filters.get('free_shipping') and 'free_shipping=true&amp;' or '') + 'discount_id=' + str(tag.id)" 
                                                   class="text-decoration-none small"
                                                   t-att-style="'color: #007bff; font-weight: bold;' if current_filters.get('discount_id') == tag.id else 'color: #6c757d;'">
                                                    <t t-esc="tag.name"/> - <t t-esc="tag.discount_percentage"/>% OFF (<t t-esc="discount_tag_counts.get(tag.id, 0)"/>)
                                                </a>
                                            </div>
                                        </t>
                                    </div>
                                </div>

                                <!-- Promotion Type -->
                                <div class="filter-section mb-4" t-if="promotion_tags">
                                    <h6 class="mb-2">Tipo de promoción</h6>
                                    <div class="promotion-options">
                                        <t t-foreach="promotion_tags" t-as="tag" t-key="tag.id">
                                            <div class="mb-1">
                                                <a t-att-href="'/subcategory?' + (current_filters.get('category_id') and ('category_id=' + str(current_filters.get('category_id')) + '&amp;') or '') + (current_filters.get('subcategory_id') and ('subcategory_id=' + str(current_filters.get('subcategory_id')) + '&amp;') or '') + (current_filters.get('brand_id') and ('brand_id=' + str(current_filters.get('brand_id')) + '&amp;') or '') + (current_filters.get('free_shipping') and 'free_shipping=true&amp;' or '') + 'promotion_id=' + str(tag.id)" 
                                                   class="text-decoration-none small"
                                                   t-att-style="'color: #007bff; font-weight: bold;' if current_filters.get('promotion_id') == tag.id else 'color: #6c757d;'">
                                                    <t t-esc="tag.name"/> (<t t-esc="promotion_tag_counts.get(tag.id, 0)"/>)
                                                </a>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-9 col-md-8">


                        <!-- Área de Productos -->
                            <div class="products-list">
                                <t t-foreach="period_products" t-as="product_data" t-key="product_data['product'].id">
                                    <div class="product-list-item p-3 mb-3" style="background: #fff; border: 1px solid #dee2e6; border-radius: 8px;">
                                        <div class="row align-items-center">
                                            <!-- Imagen del producto -->
                                            <div class="col-3">
                                                <img t-att-src="'/web/image/product.template/%s/image_1024' % product_data['product'].id"
                                                     class="img-fluid" alt="Product Image" style="max-height: 110px; object-fit: contain;"/>
                                            </div>
                                            <!-- Detalles del producto -->
                                            <div class="col-9">
                                                <div class="d-flex align-items-center mb-1">
                                                    <t t-if="product_data['product'].offer_tag">
                                                        <span class="badge" style="background: #2988f5; color: #fff; font-size: 12px; font-weight: 600; margin-right: 8px;">
                                                            <t t-esc="product_data['product'].offer_tag"/>
                                                        </span>
                                                    </t>
                                                </div>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-grow-1">
                                                        <div style="font-size: 16px; font-weight: bold; text-transform: uppercase; line-height: 1.1;">
                                                            <t t-esc="product_data['product'].name"/>
                                                        </div>
                                                        <div style="font-size: 13px; color: #757575; margin-bottom: 2px;">
                                                            por <t t-esc="product_data['product'].brand_id and product_data['product'].brand_id.name or ''"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-flex align-items-end mt-2">
                                                    <div>
                                                        <t t-if="product_data['product'].discount_percentage > 0 or product_data['product'].fixed_discount > 0">
                                                            <div style="font-size: 18px; color: #bdbdbd; text-decoration: line-through; font-weight: 400;">
                                                                <span t-esc="product_data['product'].list_price" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                                                            </div>
                                                            <div style="font-size: 28px; font-weight: bold; color: #ff5207; line-height: 1;">
                                                                <span t-esc="product_data['product'].discounted_price" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                                                                <t t-if="product_data['product'].discount_percentage > 0">
                                                                    <span style="font-size: 16px; color: #ff5207; font-weight: 600; margin-left: 6px;">
                                                                        <t t-esc="product_data['product'].discount_percentage"/>% OFF
                                                                    </span>
                                                                </t>
                                                            </div>
                                                            <div style="font-size: 15px; color: #212121; font-style: italic; margin-top: 2px;">
                                                                <t t-if="product_data['product'].discount_percentage > 0">
                                                                    <t t-set="discount_value" t-value="product_data['product'].list_price - product_data['product'].discounted_price"/>
                                                                    $<t t-esc="int(discount_value)"/> de descuento
                                                                </t>
                                                                <t t-else="">
                                                                    $<t t-esc="int(product_data['product'].fixed_discount)"/> de descuento
                                                                </t>
                                                            </div>
                                                        </t>
                                                        <t t-else="">
                                                            <div style="font-size: 28px; font-weight: bold; color: #212121;">
                                                                <span t-esc="product_data['product'].list_price" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                                                            </div>
                                                        </t>
                                                        <t t-if="product_data['product'].free_shipping">
                                                            <div style="color: #ff5207; font-size: 15px; font-style: italic; font-weight: bold; margin-top: 2px;">
                                                                Envío gratis
                                                            </div>
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                            <!-- PAGINACIÓN -->
                            <!-- ...existing code... -->
                            <!-- PAGINACIÓN -->
                            <t t-if="total_pages > 1">
                                <div class="d-flex justify-content-center mt-4">
                                    <nav aria-label="Paginación de productos">
                                        <ul class="pagination mb-0" style="background: transparent;">
                                            <!-- Botón anterior -->
                                            <li class="page-item" t-att-class="'disabled' if current_page == 1 else ''">
                                                <a class="page-link"
                                                   t-att-href="'/subcategory?' + '&amp;'.join(['%s=%s' % (k, v) for k, v in current_filters.items() if v and k != 'page'] + ['page=%s' % (current_page-1)]) if current_page &gt; 1 else '#'"
                                                   aria-label="Anterior"
                                                   style="border: none; background: transparent; color: #bdbdbd; font-size: 18px;">
                                                    <span aria-hidden="true">&#171;</span>
                                                </a>
                                            </li>
                                            <!-- Números de página dinámicos -->
                                            <t t-set="window_size" t-value="5"/>
                                            <t t-set="start_page" t-value="max(1, min(current_page - window_size//2, total_pages - window_size + 1))"/>
                                            <t t-set="end_page" t-value="min(total_pages, start_page + window_size - 1)"/>
                                            <t t-if="start_page &gt; 1">
                                                <li class="page-item">
                                                    <a class="page-link"
                                                       t-att-href="'/subcategory?' + '&amp;'.join(['%s=%s' % (k, v) for k, v in current_filters.items() if v and k != 'page'] + ['page=1'])"
                                                       style="border: none; background: transparent; color: #757575; font-size: 16px;">1</a>
                                                </li>
                                                <li class="page-item disabled"><span class="page-link" style="border: none; background: transparent; color: #bdbdbd;">...</span></li>
                                            </t>
                                            <t t-foreach="range(start_page, end_page+1)" t-as="page">
                                                <li class="page-item" t-att-class="'active' if page == current_page else ''">
                                                    <a class="page-link"
                                                       t-att-href="'/subcategory?' + '&amp;'.join(['%s=%s' % (k, v) for k, v in current_filters.items() if v and k != 'page'] + ['page=%s' % page]) if page != current_page else '#'"
                                                       t-att-style="'border: none; background: #e0e0e0; color: #757575; font-size: 16px; margin: 0 2px;' if page == current_page else 'border: none; background: transparent; color: #757575; font-size: 16px; margin: 0 2px;'">
                                                        <t t-esc="page"/>
                                                    </a>
                                                </li>
                                            </t>
                                            <t t-if="end_page &lt; total_pages">
                                                <li class="page-item disabled"><span class="page-link" style="border: none; background: transparent; color: #bdbdbd;">...</span></li>
                                                <li class="page-item">
                                                    <a class="page-link"
                                                       t-att-href="'/subcategory?' + '&amp;'.join(['%s=%s' % (k, v) for k, v in current_filters.items() if v and k != 'page'] + ['page=%s' % total_pages])"
                                                       style="border: none; background: transparent; color: #757575; font-size: 16px;"><t t-esc="total_pages"/></a>
                                                </li>
                                            </t>
                                            <!-- Botón siguiente -->
                                            <li class="page-item" t-att-class="'disabled' if current_page == total_pages else ''">
                                                <a class="page-link"
                                                   t-att-href="'/subcategory?' + '&amp;'.join(['%s=%s' % (k, v) for k, v in current_filters.items() if v and k != 'page'] + ['page=%s' % (current_page+1)]) if current_page &lt; total_pages else '#'"
                                                   aria-label="Siguiente"
                                                   style="border: none; background: transparent; color: #bdbdbd; font-size: 18px;">
                                                    <span aria-hidden="true">&#187;</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </t>
                            <!-- ...existing code... -->                          
                        </div>
    
                    </div>
                </div>
            </div>
            
            <!-- JavaScript -->
            <script type="text/javascript">
                //<![CDATA[
                function updateFilters() {
                    console.log('updateFilters called');
                    
                    // Obtener filtros actuales de la URL
                    const urlParams = new URLSearchParams(window.location.search);
                    console.log('Current URL params:', urlParams.toString());
                    
                    // Crear objeto con filtros
                    const filters = {};
                    
                    // Mantener categoría y subcategoría de la URL actual
                    const currentCategoryId = urlParams.get('category_id');
                    const currentSubcategoryId = urlParams.get('subcategory_id');
                    const currentBrandId = urlParams.get('brand_id');
                    const currentPriceRange = urlParams.get('price_range');
                    const currentDiscountId = urlParams.get('discount_id');
                    const currentPromotionId = urlParams.get('promotion_id');
                    const currentSort = urlParams.get('sort');
                    
                    if (currentCategoryId) filters.category_id = currentCategoryId;
                    if (currentSubcategoryId) filters.subcategory_id = currentSubcategoryId;
                    if (currentBrandId) filters.brand_id = currentBrandId;
                    if (currentPriceRange) filters.price_range = currentPriceRange;
                    if (currentDiscountId) filters.discount_id = currentDiscountId;
                    if (currentPromotionId) filters.promotion_id = currentPromotionId;
                    if (currentSort) filters.sort = currentSort;
                    
                    // Verificar estado del checkbox de envío gratis
                    const freeShippingCheckbox = document.getElementById('free-shipping');
                    console.log('Free shipping checkbox found:', freeShippingCheckbox);
                    console.log('Free shipping checked:', freeShippingCheckbox ? freeShippingCheckbox.checked : 'not found');
                    
                    if (freeShippingCheckbox && freeShippingCheckbox.checked) {
                        filters.free_shipping = 'true';
                        console.log('Setting free_shipping to true');
                    } else {
                        console.log('Not setting free_shipping (will show all products)');
                    }
                    
                    // Verificar dropdown de subcategorías
                    const subcategorySelect = document.getElementById('subcategory-select');
                    if (subcategorySelect && subcategorySelect.value) {
                        filters.subcategory_id = subcategorySelect.value;
                        console.log('Subcategory from dropdown:', subcategorySelect.value);
                    }
                    
                    // Verificar selector de ordenamiento
                    const sortSelect = document.getElementById('sort-select');
                    if (sortSelect && sortSelect.value && sortSelect.value !== 'relevance') {
                        filters.sort = sortSelect.value;
                        console.log('Sort from dropdown:', sortSelect.value);
                    }
                    
                    console.log('Final filters object:', filters);
                    
                    // Construir nueva URL
                    const newUrlParams = new URLSearchParams();
                    Object.keys(filters).forEach(key => {
                        if (filters[key]) {
                            newUrlParams.append(key, filters[key]);
                        }
                    });
                    
                    const newUrl = '/subcategory' + (newUrlParams.toString() ? '?' + newUrlParams.toString() : '');
                    console.log('Redirecting to:', newUrl);
                    
                    window.location.href = newUrl;
                }
                
                function updateSort() {
                    console.log('updateSort called');
                    updateFilters();
                }
                
                // Asegurar que el DOM esté cargado
                document.addEventListener('DOMContentLoaded', function() {
                    console.log('DOM loaded');
                    
                    // Verificar que el checkbox existe
                    const freeShippingCheckbox = document.getElementById('free-shipping');
                    console.log('Free shipping checkbox on load:', freeShippingCheckbox);
                    
                    if (freeShippingCheckbox) {
                        freeShippingCheckbox.addEventListener('change', function() {
                            console.log('Free shipping checkbox changed to:', this.checked);
                            updateFilters();
                        });
                    }
                    
                    // Manejar categorías
                    const categorySelect = document.getElementById('category-select');
                    if (categorySelect) {
                        categorySelect.addEventListener('change', function() {
                            const categoryId = this.value;
                            const subcategorySelect = document.getElementById('subcategory-select');
                            
                            if (categoryId) {
                                subcategorySelect.style.display = 'block';
                            } else {
                                subcategorySelect.style.display = 'none';
                                subcategorySelect.value = '';
                            }
                        });
                    }
                });
                //]]>
            </script>
        </t>
    </template>
</odoo>