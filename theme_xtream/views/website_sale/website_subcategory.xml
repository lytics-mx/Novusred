<odoo>
    <template id="website_subcategory" name="Subcategorías con Filtros">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty" style="font-family: 'Questrial', sans-serif;">
                <div class="container-fluid py-4">
                    <div class="row">
                        <!-- Sidebar de Filtros -->
                        <div class="col-lg-3 col-md-4">
                            <div class="filters-sidebar" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h4 style="margin-bottom: 20px; color: #333;">Filtros</h4>
                                
                                <!-- Categorías -->
                                <div class="filter-section mb-4">
                                    <h5 style="color: #555; margin-bottom: 15px;">Categorías</h5>
                                    <select id="category-select" class="form-select mb-2" onchange="updateFilters()">
                                        <option value="">Todas las categorías</option>
                                        <t t-foreach="categories" t-as="category" t-key="category.id">
                                            <option t-att-value="category.id" 
                                                    t-att-selected="'selected' if current_filters.get('category_id') == category.id else ''">
                                                <t t-esc="category.name"/>
                                            </option>
                                        </t>
                                    </select>
                                    
                                    <!-- Subcategorías -->
                                    <select id="subcategory-select" class="form-select" onchange="updateFilters()" t-att-style="'display: none' if not subcategories else ''">
                                        <option value="">Todas las subcategorías</option>
                                        <t t-foreach="subcategories" t-as="subcategory" t-key="subcategory.id">
                                            <option t-att-value="subcategory.id"
                                                    t-att-selected="'selected' if current_filters.get('subcategory_id') == subcategory.id else ''">
                                                <t t-esc="subcategory.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </div>
                                
                                <!-- Marcas -->
                                <div class="filter-section mb-4">
                                    <h5 style="color: #555; margin-bottom: 15px;">Marcas</h5>
                                    <div id="brands-container">
                                        <t t-foreach="available_brands" t-as="brand" t-key="brand.id">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="radio" name="brand" 
                                                       t-att-value="brand.id" t-att-id="'brand_' + str(brand.id)"
                                                       t-att-checked="'checked' if current_filters.get('brand_id') == brand.id else ''"
                                                       onchange="updateFilters()"/>
                                                <label class="form-check-label" t-att-for="'brand_' + str(brand.id)">
                                                    <t t-esc="brand.name"/>
                                                    <small class="text-muted">(<span t-att-id="'brand-count-' + str(brand.id)">0</span>)</small>
                                                </label>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                                
                                <!-- Envío Gratis -->
                                <div class="filter-section mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="free-shipping" 
                                               t-att-checked="'checked' if current_filters.get('free_shipping') else ''"
                                               onchange="updateFilters()"/>
                                        <label class="form-check-label" for="free-shipping">
                                            <strong>Envío gratis</strong>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Rango de Precios -->
                                <div class="filter-section mb-4">
                                    <h5 style="color: #555; margin-bottom: 15px;">Precio</h5>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="number" class="form-control" placeholder="Mín" id="min-price"
                                                   t-att-value="current_filters.get('min_price', '')" onchange="updateFilters()"/>
                                        </div>
                                        <div class="col-6">
                                            <input type="number" class="form-control" placeholder="Máx" id="max-price"
                                                   t-att-value="current_filters.get('max_price', '')" onchange="updateFilters()"/>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Descuentos -->
                                <div class="filter-section mb-4">
                                    <h5 style="color: #555; margin-bottom: 15px;">Descuentos</h5>
                                    <t t-foreach="discount_tags" t-as="discount" t-key="discount.id">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="discount" 
                                                   t-att-value="discount.id" t-att-id="'discount_' + str(discount.id)"
                                                   t-att-checked="'checked' if current_filters.get('discount_id') == discount.id else ''"
                                                   onchange="updateFilters()"/>
                                            <label class="form-check-label" t-att-for="'discount_' + str(discount.id)">
                                                <t t-esc="discount.name"/> (<t t-esc="int(discount.discount_percentage)"/>% OFF)
                                            </label>
                                        </div>
                                    </t>
                                </div>
                                
                                <!-- Tags de Promoción -->
                                <div class="filter-section mb-4">
                                    <h5 style="color: #555; margin-bottom: 15px;">Promociones</h5>
                                    <t t-foreach="promotion_tags" t-as="tag" t-key="tag.id">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="promotion" 
                                                   t-att-value="tag.id" t-att-id="'promotion_' + str(tag.id)"
                                                   t-att-checked="'checked' if current_filters.get('promotion_id') == tag.id else ''"
                                                   onchange="updateFilters()"/>
                                            <label class="form-check-label" t-att-for="'promotion_' + str(tag.id)">
                                                <t t-esc="tag.name"/>
                                            </label>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Área de Productos -->
                        <div class="col-lg-9 col-md-8">
                            <div class="products-grid">
                                <!-- Vista móvil -->
                                <div class="d-block d-md-none">
                                    <t t-foreach="period_products" t-as="item">
                                        <t t-set="product" t-value="item['product']" />
                                        <div class="product-item-mobile mb-3">
                                            <div class="card shadow-sm bg-white">
                                                <div class="row g-0">
                                                    <div class="col-4">
                                                        <a t-att-href="'/shop/product/' + str(product.id)">
                                                            <img t-att-src="'/web/image/product.template/' + str(product.id) + '/image_1920'" 
                                                                 class="img-fluid h-100 w-100" 
                                                                 style="object-fit: contain; min-height: 120px;" 
                                                                 loading="lazy" />
                                                        </a>
                                                    </div>
                                                    <div class="col-8">
                                                        <div class="card-body p-3">
                                                            <h6 class="card-title mb-2" style="font-size: 0.9rem; line-height: 1.3;">
                                                                <a t-att-href="'/shop/product/' + str(product.id)" class="text-decoration-none text-dark">
                                                                    <t t-esc="product.name.upper()" />
                                                                </a>
                                                            </h6>
                                                            <div class="d-flex align-items-center justify-content-between mb-1">
                                                                <span class="text-dark fw-bold" style="font-size: 18px;">
                                                                    <t t-if="product.discounted_price &amp;lt; product.list_price">
                                                                        $<t t-esc="'{:,}'.format(int(product.discounted_price))" />
                                                                    </t>
                                                                    <t t-else="">
                                                                        $<t t-esc="'{:,}'.format(int(product.list_price))" />
                                                                    </t>
                                                                </span>
                                                                <span class="text-danger" style="font-size: 16px;">
                                                                    <t t-if="product.discount_percentage">
                                                                        <t t-esc="int(product.discount_percentage)" />% OFF
                                                                    </t>
                                                                    <t t-elif="product.fixed_discount">
                                                                        -$<t t-esc="'{:,}'.format(int(product.fixed_discount))" /> MXN
                                                                    </t>
                                                                </span>
                                                            </div>
                                                            <t t-if="product.free_shipping">
                                                                <div class="mb-2">
                                                                    <span class="text-orange" style="color: #FF5207; font-size: 0.8rem; font-weight: bold; font-style: italic;">
                                                                        Envío gratis
                                                                    </span>
                                                                </div>
                                                            </t>
                                                            <p class="text-muted mb-2" style="font-size: 0.8rem;">
                                                                Por <t t-esc="product.brand_type_id.name"/>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                                <!-- Vista desktop -->
                                <div class="d-none d-md-block">
                                    <div class="row">
                                        <t t-foreach="period_products" t-as="item">
                                            <t t-set="product" t-value="item['product']" />
                                            <div class="col-lg-4 col-md-6 mb-4">
                                                <div class="card shadow-sm bg-white h-100">
                                                    <a t-att-href="'/shop/product/' + str(product.id)">
                                                        <img t-att-src="'/web/image/product.template/' + str(product.id) + '/image_1920'" 
                                                             class="card-img-top" 
                                                             style="object-fit: contain; height: 200px;"
                                                             loading="lazy" />
                                                    </a>
                                                    <div class="card-body p-3">
                                                        <h5 class="card-title mb-2" style="font-size: 1rem; line-height: 1.4;">
                                                            <a t-att-href="'/shop/product/' + str(product.id)" class="text-decoration-none text-dark">
                                                                <t t-esc="product.name.upper()" />
                                                            </a>
                                                        </h5>
                                                        <div class="d-flex align-items-center justify-content-between mb-2">
                                                            <span class="text-dark fw-bold" style="font-size: 20px;">
                                                                <t t-if="product.discounted_price &lt; product.list_price">
                                                                    $<t t-esc="'{:,}'.format(int(product.discounted_price))" />
                                                                </t>
                                                                <t t-else="">
                                                                    $<t t-esc="'{:,}'.format(int(product.list_price))" />
                                                                </t>
                                                            </span>
                                                            <span class="text-danger" style="font-size: 18px;">
                                                                <t t-if="product.discount_percentage">
                                                                    <t t-esc="int(product.discount_percentage)" />% OFF
                                                                </t>
                                                                <t t-elif="product.fixed_discount">
                                                                    -$<t t-esc="'{:,}'.format(int(product.fixed_discount))" /> MXN
                                                                </t>
                                                            </span>
                                                        </div>
                                                        <t t-if="product.free_shipping">
                                                            <div class="mb-2">
                                                                <span class="text-orange" style="color: #FF5207; font-size: 0.9rem; font-weight: bold; font-style: italic;">
                                                                    Envío gratis
                                                                </span>
                                                            </div>
                                                        </t>
                                                        <p class="text-muted mb-0" style="font-size: 0.9rem;">
                                                            Por <t t-esc="product.brand_type_id.name"/>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
        <!-- JavaScript para filtros dinámicos -->
        <script>
            function updateFilters() {
                // Recopilar todos los filtros activos
                const filters = {};
                
                // Categoría
                const categorySelect = document.getElementById('category-select');
                if (categorySelect && categorySelect.value) {
                    filters.category_id = categorySelect.value;
                }
                
                // Subcategoría
                const subcategorySelect = document.getElementById('subcategory-select');
                if (subcategorySelect && subcategorySelect.value) {
                    filters.subcategory_id = subcategorySelect.value;
                }
                
                // Marca
                const brandRadio = document.querySelector('input[name="brand"]:checked');
                if (brandRadio) {
                    filters.brand_id = brandRadio.value;
                }
                
                // Envío gratis
                const freeShipping = document.getElementById('free-shipping');
                if (freeShipping && freeShipping.checked) {
                    filters.free_shipping = true;
                }
                
                // Precios
                const minPrice = document.getElementById('min-price');
                const maxPrice = document.getElementById('max-price');
                if (minPrice && minPrice.value) {
                    filters.min_price = minPrice.value;
                }
                if (maxPrice && maxPrice.value) {
                    filters.max_price = maxPrice.value;
                }
                
                // Descuento
                const discountRadio = document.querySelector('input[name="discount"]:checked');
                if (discountRadio) {
                    filters.discount_id = discountRadio.value;
                }
                
                // Promoción
                const promotionRadio = document.querySelector('input[name="promotion"]:checked');
                if (promotionRadio) {
                    filters.promotion_id = promotionRadio.value;
                }
                
                // Construir URL con parámetros
                const urlParams = new URLSearchParams();
                Object.keys(filters).forEach(key => {
                    if (filters[key]) {
                        urlParams.append(key, filters[key]);
                    }
                });
                
                // Recargar página con filtros
                const currentUrl = window.location.pathname;
                const newUrl = urlParams.toString() ? `${currentUrl}?${urlParams.toString()}` : currentUrl;
                window.location.href = newUrl;
            }
            
            // Función para actualizar subcategorías cuando cambia la categoría
            document.getElementById('category-select').addEventListener('change', function() {
                const categoryId = this.value;
                const subcategorySelect = document.getElementById('subcategory-select');
                
                if (categoryId) {
                    // Mostrar select de subcategorías
                    subcategorySelect.style.display = 'block';
                    
                    // Aquí podrías hacer una llamada AJAX para obtener las subcategorías
                    // Por ahora, simplemente actualiza los filtros
                    updateFilters();
                } else {
                    // Ocultar select de subcategorías
                    subcategorySelect.style.display = 'none';
                    subcategorySelect.value = '';
                    updateFilters();
                }
            });
            
            // Limpiar otros radio buttons cuando se selecciona uno nuevo
            document.querySelectorAll('input[name="brand"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        // Limpiar otros filtros de radio button si es necesario
                        document.querySelectorAll('input[name="discount"]').forEach(r => r.checked = false);
                        document.querySelectorAll('input[name="promotion"]').forEach(r => r.checked = false);
                    }
                });
            });
            
            document.querySelectorAll('input[name="discount"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        document.querySelectorAll('input[name="brand"]').forEach(r => r.checked = false);
                        document.querySelectorAll('input[name="promotion"]').forEach(r => r.checked = false);
                    }
                });
            });
            
            document.querySelectorAll('input[name="promotion"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        document.querySelectorAll('input[name="brand"]').forEach(r => r.checked = false);
                        document.querySelectorAll('input[name="discount"]').forEach(r => r.checked = false);
                    }
                });
            });
        </script>
                

    </template>
</odoo>