<odoo>
    <template id="subcategory_redirect" name="Subcategory Redirect">
        <t t-call="website.layout">
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-md-8 text-center">
                        <div class="card shadow-sm">
                            <div class="card-body p-5">
                                <div class="mb-4">
                                    <i class="fa fa-search fa-3x text-primary"></i>
                                </div>
                                
                                <h3 class="mb-3">Resultados de búsqueda</h3>
                                <p class="text-muted mb-4">
                                    Buscando: <strong t-esc="search"/>
                                </p>
                                
                                <!-- Mostrar productos similares si los hay -->
                                <t t-if="similar_products">
                                    <div class="mb-4">
                                        <h5>Productos relacionados encontrados:</h5>
                                        <div class="row">
                                            <t t-foreach="similar_products" t-as="similar_product">
                                                <div class="col-md-6 mb-2">
                                                    <div class="border rounded p-2">
                                                        <small class="text-muted" t-esc="similar_product.name"/>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                </t>
                                
                                <!-- Mensaje de redirección -->
                                <div class="alert alert-info">
                                    <i class="fa fa-info-circle"></i>
                                    <t t-if="product">
                                        Producto encontrado. Redirigiendo en <span id="countdown">1</span> segundo(s)...
                                    </t>
                                    <t t-if="not product">
                                        Mostrando resultados en <span id="countdown">1</span> segundo(s)...
                                    </t>
                                </div>
                                
                                <!-- Spinner de carga -->
                                <div class="d-flex justify-content-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Cargando...</span>
                                    </div>
                                </div>
                                
                                <!-- Enlaces manuales por si falla el redirect -->
                                <div class="mt-4">
                                    <t t-if="redirect_url">
                                        <a t-att-href="redirect_url" class="btn btn-primary me-2">
                                            <i class="fa fa-eye"></i> Ver producto
                                        </a>
                                    </t>
                                    <a t-att-href="'/subcategory?search=' + search" class="btn btn-outline-secondary">
                                        <i class="fa fa-list"></i> Ver todos los resultados
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Script para countdown y redirect automático -->
            <script type="text/javascript">
                document.addEventListener('DOMContentLoaded', function() {
                    var countdown = 1;
                    var countdownElement = document.getElementById('countdown');
                    var redirectUrl = document.getElementById('redirect_url_data') ? document.getElementById('redirect_url_data').getAttribute('data-url') : '';

                    // Si no hay URL de redirect específica, usar subcategory
                    if (!redirectUrl) {
                        redirectUrl = document.getElementById('subcategory_url_data').getAttribute('data-url');
                    }

                    var timer = setInterval(function() {
                        countdown--;
                        if (countdownElement) {
                            countdownElement.textContent = countdown;
                        }

                        if (countdown <= 0) {
                            clearInterval(timer);
                            window.location.href = redirectUrl;
                        }
                    }, 1000);

                    // También permitir redirect inmediato si se hace clic en cualquier parte
                    document.body.addEventListener('click', function() {
                        clearInterval(timer);
                        window.location.href = redirectUrl;
                    });
                });
            </script>
            <t t-if="redirect_url">
                <span id="redirect_url_data" t-att-data-url="redirect_url" style="display:none;"></span>
            </t>
            <span id="subcategory_url_data" t-att-data-url="'/subcategory?search=' + search" style="display:none;"></span>
        </t>
    </template>
</odoo>