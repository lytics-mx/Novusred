<odoo>
    <template id="website_view_product_xtream_mobile" inherit_id="website_view_product_xtream">
        <xpath expr="//div[@id='wrap']" position="inside">
            <div class="d-block d-md-none w-100 px-0 py-2" style="font-family: 'Montserrat', Arial, sans-serif; width:100%; max-width:100%; margin:0; padding-top:0.5rem; padding-bottom:0.5rem;">
                <!-- Estado del producto -->
                <t t-set="pdate" t-value="product.create_date"/>
                <t t-set="now" t-value="datetime.datetime.now()"/>
                <div t-if="pdate and pdate.year == now.year and pdate.month == now.month" style="font-size:12px; color:#888;">
                    Nuevo
                </div>                <!-- Título -->
                <div style="font-size:18px; font-weight:600; margin-bottom:4px;">
                    <t t-esc="product.name and (product.name[:40] + '' if len(product.name) > 40 else product.name)"/>
                </div>
                <div style="font-size:13px; color:#888; margin-bottom:4px;">
                    <t t-if="product.product_model">
                        <t t-esc="product.product_model"/>
                    </t>
                    <t t-elif="product.default_code">
                        <t t-esc="product.default_code"/>
                    </t>
                </div>
                <!-- Estrellas -->
                <div class="mb-2">
                    <span style="color:#0057ff; font-size:20px;">&#9733;&#9733;&#9733;&#9733;</span>
                    <span style="color:#ccc; font-size:20px;">&#9733;</span>
                </div>
                <!-- Slider de imágenes -->
                <div class="mb-2 text-center">
                    <t t-set="pcount" t-value="1 + (len(product.product_image_ids) if product.product_image_ids else 0)"/>
                    <span style="font-size:11px; background:#f2f2f2; border-radius:8px; padding:2px 8px;">
                        <t t-esc="1"/> / <t t-esc="pcount"/>
                    </span>
                </div>
                <div class="mb-3 text-center">
                    <!-- Imagen principal primero -->
                    <img id="main-product-img"
                         t-att-src="'/web/image/product.template/' + str(product.id) + '/image_1920'"
                         alt="Imagen principal"
                         style="max-width:100%; border-radius:10px; object-fit:contain;"/>
                </div>
                <!-- Imágenes adicionales (si existen) -->
                <t t-if="product.product_image_ids">
                    <div class="d-flex justify-content-center gap-2 mb-3" style="overflow:auto; padding-bottom:4px;">
                        <t t-foreach="product.product_image_ids" t-as="img">
                            <img t-att-src="'/web/image/product.image/' + str(img.id) + '/image_1920'"
                                 t-att-alt="img.name or 'Imagen adicional'"
                                 class="img-thumbnail thumb-mini"
                                 t-att-data-img="'/web/image/product.image/' + str(img.id) + '/image_1920'"
                                 style="height:64px; width:auto; cursor:pointer; border-radius:8px;"/>
                        </t>
                    </div>
                </t>
                <!-- Precio y descuento -->
                <div class="card-body mobile-card-body" style="text-align:left;">
                    <!-- <t t-if="product.product_tag_ids">
                        <div class="d-flex justify-content-start mb-2 mobile-badge-container">
                            <span class="badge bg-primary mobile-badge" style="border-radius: 0; text-transform: uppercase;">
                                <t t-esc="product.product_tag_ids[0].name"/>
                            </span>
                        </div>
                    </t> -->
                    <t t-if="product.discounted_price &lt; product.list_price">
                        <div class="mt-0 mobile-discount-amount">
                            <span class="text-muted" style="font-size: 16px; text-decoration: line-through;">
                                $<t t-esc="'{:,}'.format(int(product.list_price))" />
                            </span>
                        </div>
                        <div class="d-flex align-items-center justify-content-start mobile-price-container" style="text-align:left; gap:8px;">
                            <span class="text-dark fw-bold mobile-main-price" style="font-size: 28px; color: #000; font-weight: bold;">
                                $<t t-esc="'{:,}'.format(int(product.discounted_price))" />
                            </span>
                            <t t-if="product.discount_percentage or product.fixed_discount">
                                <span class="mobile-discount" style="font-size: 16px; font-weight: normal; color: #FF5207; margin-left:8px;">
                                    <t t-if="product.discount_percentage">
                                        <t t-esc="int(product.discount_percentage)" />% OFF
                                    </t>
                                    <t t-elif="product.fixed_discount">
                                        -$<t t-esc="'{:,}'.format(int(product.fixed_discount))" /> MXN
                                    </t>
                                </span>
                            </t>
                        </div>
                        <t t-if="product.list_price and product.discounted_price and (product.list_price - product.discounted_price) &gt; 0">
                            <div class="mt-0 mobile-discount-amount">
                                <span class="text-muted">
                                    $<t t-esc="'{:,}'.format(int(product.list_price - product.discounted_price))" /> descuento
                                </span>
                            </div>
                        </t>
                    </t>
                    <t t-elif="product.list_price">
                        <span class="fw-bold d-block mobile-main-price" style="text-align:left;">
                            $<t t-esc="'{:,}'.format(int(product.list_price))" />
                        </span>
                    </t>
                </div>
                <!-- Envío gratis -->
                <t t-if="product.free_shipping">
                    <div class="mt-0 mobile-shipping d-flex justify-content-start" style="text-align:left;">
                        <span class="text-orange mobile-shipping-text">
                            Envío gratis
                        </span>
                    </div>
                </t>
                <!-- Detalles -->
                <div class="text-start" style="font-size:13px; color:#444; text-align:left;">
                    <div>Modelo: <t t-esc="product.default_code"/></div>
                    <div>Marca: <t t-esc="product.brand_type_id.name"/></div>
                    <div>Disponible:</div>
                </div>
                <!-- Selector de cantidad -->
                <div class="my-3">
                    <button type="button" class="btn btn-light w-100" id="qty-toggle-btn" style="border-radius:8px; border:1px solid #e0e0e0; text-align:left; display:flex; align-items:center; justify-content:space-between; padding:0.5rem;">
                        <span>
                            Cantidad: <span id="qty-toggle-value"></span>
                            <span style="color:#888; font-size:14px;">(<t t-esc="int(product.qty_available)"/> disponibles)</span>
                        </span>
                        <span class="float-end">&gt;</span>
                    </button>

                    <div id="mobile-qty-container" style="display:none; margin-top:8px; align-items:center;">
                        <div style="font-size:16px; margin-bottom:6px; width:100%; display:flex; align-items:center; justify-content:space-between;">
                            <span style="font-weight:500;">Cantidad:</span>
                            <span class="input-group" style="width:auto; display:inline-flex; vertical-align:middle; margin-left:6px;">
                                <button type="button" class="btn" id="qty-minus" style="min-width:28px; font-size:20px; padding:0; background:transparent; border:none; color:#222;">-</button>
                                <input id="qty-input" type="number" name="add_qty" value="1" min="1" t-att-max="product.qty_available"
                                    class="form-control text-center"
                                    style="width:2.5em; min-width:32px; max-width:3em; padding:0 4px; border:none; box-shadow:none; background:transparent; outline:none; font-size:14px;"
                                    onwheel="return false;"
                                    inputmode="numeric"
                                    maxlength="4"
                                />
                                <button type="button" class="btn" id="qty-plus" style="min-width:28px; font-size:20px; padding:0; background:transparent; border:none; color:#222;">+</button>
                            </span>
                        </div>
                    </div>
                </div>

                <t t-jquery="body" t-operation="append">
                    <style>
                        /* Oculta las flechas de los inputs type number en todos los navegadores */
                        input[type=number]::-webkit-inner-spin-button, 
                        input[type=number]::-webkit-outer-spin-button { 
                            -webkit-appearance: none; 
                            margin: 0; 
                        }
                        input[type=number] {
                            -moz-appearance: textfield;
                        }
                        /* Ajusta el ancho del input según el número de dígitos */
                        #qty-input {
                            width: 2.5em !important;
                            min-width: 32px !important;
                            max-width: 3em !important;
                            text-align: center;
                        }
                    </style>
                </t>

                <t t-jquery="body" t-operation="append">
                    <script type="text/javascript"><![CDATA[
                        document.addEventListener('DOMContentLoaded', function() {
                            var toggleBtn = document.getElementById('qty-toggle-btn');
                            var container = document.getElementById('mobile-qty-container');
                            var qtyInput = document.getElementById('qty-input');
                            var minusBtn = document.getElementById('qty-minus');
                            var plusBtn = document.getElementById('qty-plus');
                            var toggleValue = document.getElementById('qty-toggle-value');

                            if (!toggleBtn || !container || !qtyInput) return;

                            function updateToggleText() {
                                var val = parseInt(qtyInput.value) || 1;
                                toggleValue.textContent = val;
                            }

                            toggleBtn.addEventListener('click', function() {
                                var isOpen = container.style.display === 'flex' || container.style.display === 'block';
                                container.style.display = isOpen ? 'none' : 'flex';
                                if (!isOpen) {
                                    // show -> focus input
                                    qtyInput.focus();
                                }
                            });

                            // Quantity control logic
                            var max = parseInt(qtyInput.getAttribute('max')) || 9999;
                            minusBtn && minusBtn.addEventListener('click', function() {
                                var val = parseInt(qtyInput.value) || 1;
                                if (val > 1) {
                                    qtyInput.value = val - 1;
                                    updateToggleText();
                                }
                            });
                            plusBtn && plusBtn.addEventListener('click', function() {
                                var val = parseInt(qtyInput.value) || 1;
                                if (val < max) {
                                    qtyInput.value = val + 1;
                                    updateToggleText();
                                }
                            });
                            qtyInput.addEventListener('input', function() {
                                var val = parseInt(qtyInput.value) || 1;
                                if (val < 1) val = 1;
                                if (val > max) val = max;
                                qtyInput.value = val;
                                updateToggleText();
                            });

                            // initialize
                            updateToggleText();
                        });
                    ]]></script>
                </t>
                <!-- Métodos de pago -->
                <div style="font-size:13px; color:#888;">Puedes pagar con:</div>
                <div class="d-flex flex-wrap align-items-center mb-3" style="gap:8px;">
                    <!-- <img src="/theme_xtream/static/src/img/visa.svg" style="height:24px;"/>
                    <img src="/theme_xtream/static/src/img/mastercard.svg" style="height:24px;"/>
                    <img src="/theme_xtream/static/src/img/amex.svg" style="height:24px;"/>
                    <img src="/theme_xtream/static/src/img/paypal.svg" style="height:24px;"/>
                    <img src="/theme_xtream/static/src/img/oxxo.svg" style="height:24px;"/> -->
                </div>
                <!-- Botones -->
                <button class="btn btn-primary w-100 mb-2" style="background:#2979ff; border-radius:8px; font-weight:600;">
                    Agregar al carrito
                </button>
                <button class="btn btn-primary w-100" style="background:#82b1ff; border-radius:8px; font-weight:600;">
                    Agregar al carrito
                </button>
            </div>
        </xpath>
    </template>
</odoo>