<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="delivered_template" name="Compras">
        <t t-call="website.layout">
            <div class="container mt-5 d-none d-lg-block">
                <t t-if="delivered_products or pending_products">
                    <h2 class="mb-4" style="font-size:22px;">Compras</h2>
                </t>

                <!-- Buscador y filtrado -->
                <div class="d-flex align-items-center mb-4" style="gap: 24px;">
                    <form method="get" action="/delivered" class="d-flex align-items-center" style="gap: 12px;">
                        <div class="input-group" style="background: #d3d3d3; border-radius: 20px; padding: 0 12px; height: 40px; align-items: center;">
                            <span class="input-group-text bg-transparent border-0" style="padding-right: 0;">
                                <i class="fa fa-search" style="color: #222;"></i>
                            </span>
                            <input type="text" name="search" t-att-value="search" placeholder="Buscar..." class="form-control border-0 bg-transparent" style="box-shadow: none; font-family: 'Questrial', sans-serif; font-size: 15px; width: 200px;" />
                        </div>
                        <div class="input-group" style="background: #d3d3d3; border-radius: 20px; padding: 0 12px; height: 40px; align-items: center;">
                            <span class="input-group-text bg-transparent border-0" style="padding-right: 0;">
                                <i class="fa fa-filter" style="color: #222;"></i>
                            </span>
                            <select name="filter_state" class="form-select border-0 bg-transparent" style="box-shadow: none; font-family: 'Questrial', sans-serif; font-size: 15px; width: 120px;"
                                onchange="this.form.submit()">
                                <option value="all" t-att-selected="filter_state == 'all'">Todas</option>
                                <option value="assigned" t-att-selected="filter_state == 'assigned'">En camino</option>
                                <option value="done" t-att-selected="filter_state == 'done'">Entregado</option>
                            </select>
                        </div>
                    </form>
                    <p class="mb-0" style="font-family: 'Questrial', sans-serif; font-size: 15px; color: #222;"><t t-esc="product_count"/> Compras</p>
                </div>

                <div class="row">
                    <!-- Mensaje si no hay productos -->
                    <t t-if="not delivered_products and not pending_products">
                        <t t-if="filter_state != 'all'">
                            <div class="col-12 text-center">
 

                                <div class="card p-4" style="background-color: #fff;">
                                    <h4 class="mb-3">No tienes ningún pedido en el estado seleccionado</h4>
                                    <p class="mb-4">Por favor intenta con otro filtro o revisa tus compras.</p>
                                </div>
                            </div>
                        </t>
                        <t t-elif="search">
                            <div class="col-12 text-center">
                                <div class="card p-4" style="background-color: #fff;">
                                    <h4 class="mb-3">No se encontraron coincidencias</h4>
                                    <p class="mb-4">No hay productos que coincidan con tu búsqueda.</p>
                                </div>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="col-12 text-center">
                                <div class="card p-4" style="background-color: #fff;">
                                    <h4 class="mb-3">No tienes compras aún</h4>
                                    <p class="mb-4">Por favor navega por nuestro catálogo y encuentra productos de Odoo que te interesen.</p>
                                    <div class="d-flex justify-content-center">
                                        <a href="/subcategory" class="btn btn-primary" style="width: fit-content;">Ir al catálogo</a>
                                    </div>
                                </div>
                            </div>
                        </t>
                    <div style="height: 45px;"></div>    
                    </t>

                    <!-- Productos entregados -->
                    <t t-foreach="delivered_products" t-as="product">
                        <t t-if="product['state'] == 'done'">
                            <div class="col-12 mb-3">
                                <div class="card p-3 shadow-sm" style="background-color:rgb(255, 255, 255); border: none;">
                                    <!-- Fecha de compra -->
                                    <div class="d-flex flex-column align-items-start">
                                        <p class="mb-0" style="font-size: 16px; color: #000;">
                                            <t t-esc="product['purchase_date']"/>
                                        </p>
                                    </div>
                                    <!-- Imagen del producto -->
                                    <div class="d-flex flex-row align-items-center mt-1">
                                        <div class="me-3" style="flex: 0 0 100px;">
                                            <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded" style="width: 100px; height: auto;" />
                                        </div>
                                        <!-- Detalles del producto -->
                                        <div class="flex-grow-1 me-3">
                                            <p class="mb-1" style="color: #FF5207; font-size: 16px;">
                                                <t t-esc="product['purchase_date']"/>
                                            </p>
                                            
                                            <p class="mb-1" style="color: #000; font-size: 16px;">Entregado el <t t-esc="product['delivery_date']"/></p>
                                            <!-- Envío gratis -->
                                            <t t-if="product.get('free_shipping')">
                                                <p class="mb-1" style="color: #FF5207; font-size: 18px; font-style: italic; font-weight: bold;">
                                                    Envío gratis
                                                </p>
                                            </t>                                            
                                            
                                            <p class="text-muted mb-1">
                                                <a t-att-href="product['website_url']" style="text-decoration: none; color: inherit;">
                                                    <t t-esc="product['product_name'][:100] + ('...' if len(product['product_name']) > 113 else '')"/>
                                                </a>                                            
                                            </p>

                                            <p class="text-muted"><t t-esc="product['quantity']"/> Unidad</p>                                
                                        </div>
                                        <!-- Enviar mensaje -->
                                        <!-- <div class="me-3">
                                            <a href="#" class="btn btn-link text-primary" style="font-size:16px; font-family:'Questrial', sans-serif;">Enviar mensaje</a>
                                        </div> -->
                                        <!-- Botones -->
                                        <div class="d-flex flex-column" style="min-width: 150px;">
                                            <a t-att-href="'/product_details/%d/%s' % (product['product_id'], product['picking_origin'])"
                                               class="btn mb-2"
                                               style="background-color: #3483FA; border: none; color: #fff; font-size: 16px; font-family: 'Questrial', sans-serif; border-radius: 8px; padding: 10px 24px; box-shadow: 0 2px 8px rgba(52,131,250,0.15); text-align: center;">
                                                Ingresar
                                            </a>

                                            <a t-att-href="product['website_url']"
                                               class="btn mx-auto"
                                               style="background-color: #a5c8fa; border: none; color: #2267e3; border-radius: 8px; font-size: 16px; font-family: 'Questrial', sans-serif; padding: 10px 24px; text-align: center; display: block; width: fit-content;">
                                                Volver a comprar
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>

                    <!-- Productos pendientes -->
                    <t t-foreach="pending_products" t-as="product">
                        <t t-if="product['state'] != 'assigned' and product['state'] != 'draft'">
                            <div class="col-12 mb-3">
                                <div class="card p-3 shadow-sm" style="background-color:rgb(255, 255, 255); border: none;">
                                    <!-- Fecha de compra -->
                                    <div class="d-flex flex-column align-items-start">
                                        <p class="mb-0" style="font-size: 16px; color: #000;">
                                            <t t-esc="product['purchase_date']"/>
                                        </p>
                                    </div>
                                    <!-- Imagen del producto -->
                                    <div class="d-flex flex-row align-items-center mt-1">
                                        <div class="me-3" style="flex: 0 0 100px;">
                                            <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded" style="width: 100px; height: auto;" />
                                        </div>
                                        <!-- Detalles del producto -->
                                        <div class="flex-grow-1 me-3">
                                            <p class="mb-1" style="color: #FF5207; font-size: 16px;">En camino</p>
                                    
                                        <!-- Estado de fecha estimada de entrega -->
                                            <p class="mb-1" style="color: #000; font-size: 16px;">
                                                <t t-esc="product['deadline_date']"/>
                                            </p>
                                        <!-- Envío gratis -->
                                            <t t-if="product.get('free_shipping')">
                                                <p class="mb-1" style="color: #FF5207; font-size: 18px; font-style: italic; font-weight: bold;">
                                                    Envío gratis
                                                </p>
                                            </t>
                                            <p class="text-muted mb-1">
                                                <a t-att-href="product['website_url']" style="text-decoration: none; color: inherit;">
                                                    <t t-esc="product['product_name'][:100] + ('...' if len(product['product_name']) > 113 else '')"/>
                                                </a>                                            
                                            </p>
                                            <p class="text-muted"><t t-esc="product['quantity']"/> Unidad</p>                                
                                        </div>
                                        <!-- Enviar mensaje -->
                                        <!-- <div class="me-3">
                                            <a href="#" class="btn btn-link text-primary" style="font-size:16px; font-family:'Questrial', sans-serif;">Enviar mensaje</a>
                                        </div> -->
                                        <!-- Botones -->
                                        <div class="d-flex flex-column" style="min-width: 150px;">
                                            <a t-att-href="'/product_details/%d/%s' % (product['product_id'], product['picking_origin'])"
                                               class="btn mb-2"
                                               style="background-color: #3483FA; border: none; color: #fff; font-size: 16px; font-family: 'Questrial', sans-serif; border-radius: 8px; padding: 10px 24px; box-shadow: 0 2px 8px rgba(52,131,250,0.15); text-align: center;">
                                                Ingresar
                                            </a>                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>
                    <div style="height: 45px;"></div>
                </div>
            </div>
            <div class="d-flex align-items-center mb-3" style="position: relative;">
                <form method="get" action="/delivered" class="w-100">
                    <div style="background: #fff; border-radius: 20px; height: 36px; display: flex; align-items: center; width: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <!-- Lupa -->
                        <span class="input-group-text bg-transparent border-0" style="padding-left: 12px; padding-right: 0;">
                            <i class="fa fa-search" style="color: #222;"></i>
                        </span>
                        <!-- Input -->
                        <input type="text" name="search" t-att-value="search" placeholder="Buscar..." 
                            class="form-control border-0 bg-transparent" 
                            style="box-shadow: none; font-family: 'Questrial', sans-serif; font-size: 14px; width: 100%; padding-left: 8px; padding-right: 8px;" />
                        <!-- Filtro -->
                        <div id="filterDropdown" style="display: flex; align-items: center; cursor:pointer; padding-right: 12px;" onclick="document.getElementById('filterOptions').classList.toggle('d-none');">
                            <i class="fa fa-filter" style="color: #222;"></i>
                            <span style="font-family: 'Questrial', sans-serif; font-size: 14px; color: #2267e3; margin-left: 4px;">
                                <t t-if="filter_state == 'all'">Todas</t>
                                <t t-elif="filter_state == 'assigned'">En camino</t>
                                <t t-elif="filter_state == 'done'">Entregado</t>
                            </span>
                            <span style="color:#2267e3; font-size:14px; margin-left:2px;">&#94;</span>
                        </div>
                    </div>
                    <div id="filterOptions" class="d-none" style="position: absolute; top: 42px; right: 0; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); z-index: 10; min-width: 120px;">
                        <button type="submit" name="filter_state" value="all" class="dropdown-item" style="width:100%; text-align:left; padding:8px 16px; border:none; background:none; font-family:'Questrial',sans-serif; font-size:14px; color:#222;">Todas</button>
                        <button type="submit" name="filter_state" value="assigned" class="dropdown-item" style="width:100%; text-align:left; padding:8px 16px; border:none; background:none; font-family:'Questrial',sans-serif; font-size:14px; color:#222;">En camino</button>
                        <button type="submit" name="filter_state" value="done" class="dropdown-item" style="width:100%; text-align:left; padding:8px 16px; border:none; background:none; font-family:'Questrial',sans-serif; font-size:14px; color:#222;">Entregado</button>
                    </div>
                </form>
            </div>
            <script>
                document.addEventListener('click', function(e) {
                    var filter = document.getElementById('filterDropdown');
                    var options = document.getElementById('filterOptions');
                    if (!filter.contains(e.target)) {
                        options.classList.add('d-none');
                    }
                });
            </script>
            
                <!-- Mensaje si no hay productos -->
                <t t-if="not delivered_products and not pending_products">
                    <t t-if="filter_state != 'all'">
                        <div class="text-center">
                            <div class="card p-3" style="background-color: #fff;">
                                <h5 class="mb-2" style="font-size: 16px;">No tienes ningún pedido en el estado seleccionado</h5>
                                <p class="mb-3" style="font-size: 14px;">Por favor intenta con otro filtro o revisa tus compras.</p>
                            </div>
                        </div>
                    </t>
                    <t t-elif="search">
                        <div class="text-center">
                            <div class="card p-3" style="background-color: #fff;">
                                <h5 class="mb-2" style="font-size: 16px;">No se encontraron coincidencias</h5>
                                <p class="mb-3" style="font-size: 14px;">No hay productos que coincidan con tu búsqueda.</p>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="text-center">
                            <div class="card p-3" style="background-color: #fff;">
                                <h5 class="mb-2" style="font-size: 16px;">No tienes compras aún</h5>
                                <p class="mb-3" style="font-size: 14px;">Por favor navega por nuestro catálogo y encuentra productos de Odoo que te interesen.</p>
                                <div class="d-flex justify-content-center">
                                    <a href="/subcategory" class="btn btn-primary" style="width: fit-content;">Ir al catálogo</a>
                                </div>
                            </div>
                        </div>
                    </t>
                    <div style="height: 30px;"></div>
                </t>
            
                <!-- Productos entregados -->
                <t t-foreach="delivered_products" t-as="product">
                    <t t-if="product['state'] == 'done'">
                        <div class="card mb-2 p-2" style="background-color: #fff; border-radius: 12px; border: none;">
                            <div class="d-flex flex-row align-items-start">
                                <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded me-2" style="width: 80px; height: auto;" />
                                <div class="flex-grow-1">
                                    <div style="font-size: 13px; color: #222; margin-bottom: 2px;">
                                        <t t-esc="product['purchase_date']"/>
                                    </div>
                                    <div style="color: #FF5207; font-size: 14px; font-weight: 500;">Entregado</div>
                                    <div style="color: #000; font-size: 13px;">Entregado el <t t-esc="product['delivery_date']"/></div>
                                    <t t-if="product.get('free_shipping')">
                                        <div style="color: #FF5207; font-size: 15px; font-style: italic; font-weight: bold;">Envío gratis</div>
                                    </t>
                                    <div class="text-muted" style="font-size: 13px; margin-bottom: 2px;">
                                        <a t-att-href="product['website_url']" style="text-decoration: none; color: inherit;">
                                            <t t-esc="product['product_name'][:50] + ('...' if len(product['product_name']) > 53 else '')"/>
                                        </a>
                                    </div>
                                    <div class="text-muted" style="font-size: 13px;"><t t-esc="product['quantity']"/> Unidad</div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            
                <!-- Productos pendientes -->
                <t t-foreach="pending_products" t-as="product">
                    <t t-if="product['state'] != 'done' and product['state'] != 'draft'">
                        <div class="card mb-2 p-2" style="background-color: #fff; border-radius: 12px; border: none;">
                            <div class="d-flex flex-row align-items-start">
                                <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded me-2" style="width: 80px; height: auto;" />
                                <div class="flex-grow-1">
                                    <div style="font-size: 13px; color: #222; margin-bottom: 2px;">
                                        <t t-esc="product['purchase_date']"/>
                                    </div>
                                    <div style="color: #FF5207; font-size: 14px; font-weight: 500;">En camino</div>
                                    <div style="color: #000; font-size: 13px;">
                                        <t t-esc="product['deadline_date']"/>
                                    </div>
                                    <t t-if="product.get('free_shipping')">
                                        <div style="color: #FF5207; font-size: 15px; font-style: italic; font-weight: bold;">Envío gratis</div>
                                    </t>
                                    <div class="text-muted" style="font-size: 13px; margin-bottom: 2px;">
                                        <a t-att-href="product['website_url']" style="text-decoration: none; color: inherit;">
                                            <t t-esc="product['product_name'][:50] + ('...' if len(product['product_name']) > 53 else '')"/>
                                        </a>
                                    </div>
                                    <div class="text-muted" style="font-size: 13px;"><t t-esc="product['quantity']"/> Unidad</div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
                <div style="height: 30px;"></div>
            </div>


        </t>
    </template>
</odoo>