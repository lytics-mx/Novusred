<odoo>
  <template id="website_cart_buy_now" inherit_id="website_sale.cart">
    <xpath expr="." position="replace">
      <t t-call="website.layout">
        <div id="wrap" class="oe_website_sale" style="background:#ededed;min-height:100vh;">
          <div class="container py-5">
            <div class="card shadow-sm rounded" style="max-width:900px;margin:auto;background:#fff;">
                <div class="card-body p-0" style="background-color:#fff;">
                <h5 class="px-3 pt-3 pb-1 mb-0" style="font-weight:500;">Carrito (<t t-esc="len(website_sale_order.order_line)"/>)</h5>
                <hr class="my-0"/>
                <t t-set="order" t-value="website_sale_order"/>
                <t t-if="order and order.order_line">
                  <t t-foreach="order.order_line" t-as="line">
                  <div class="row align-items-center px-2 py-2 border-bottom">
                    <div class="col-2">
                    <img t-att-src="'/web/image/product.product/%d/image_128' % line.product_id.id"
                       class="img-fluid rounded" style="max-width:50px;"/>
                    </div>
                    <div class="col-5">
                    <div class="fw-semibold" style="font-size:14px;">
                      <t t-esc="line.product_id.display_name"/>
                    </div>
                    <div class="text-muted small mb-0">
                      <t t-if="line.product_id.product_tmpl_id.brand_type_id">
                        por <t t-esc="line.product_id.product_tmpl_id.brand_type_id.name"/>
                      </t>
                    </div>
                    <div style="font-size:12px;">
                      <a t-att-href="'/shop/cart/remove?line_id=%d' % line.id"
                       style="color:#0009ED;" class="small">Eliminar</a>
                      <span class="mx-1 text-muted">|</span>
                      <a t-att-href="'/subcategory?brand_id=%s' % (line.product_id.product_tmpl_id.brand_type_id.id if line.product_id.product_tmpl_id.brand_type_id else '')"
                      style="color:#0009ED;" class="small">Más productos</a>
                      <span class="mx-1 text-muted">|</span>
                      <a t-att-href="'/shop/cart/save_for_later?line_id=%d&amp;product_id=%d' % (line.id, line.product_id.id)"
                       style="color:#0009ED;" class="small">Guardar</a>                     
                    </div>
                    </div>
                    <div class="col-2 text-center">
                    <form t-att-action="'/shop/cart/update'" method="post" class="d-inline-flex align-items-center">
                      <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                      <input type="hidden" name="line_id" t-att-value="line.id"/>
                      <button name="set_qty" t-att-value="line.product_uom_qty - 1"
                          class="btn btn-outline-secondary btn-sm p-0" style="width:20px;height:20px;" t-att-disabled="line.product_uom_qty &lt;= 1">-</button>
                      <input type="number" name="set_qty" t-att-value="line.product_uom_qty" min="1"
                         class="form-control text-center mx-1" style="width:30px;height:20px;padding:2px;"/>
                      <button name="set_qty" t-att-value="line.product_uom_qty + 1"
                          class="btn btn-outline-secondary btn-sm p-0" style="width:20px;height:20px;">+</button>
                    </form>
                    <div class="small text-muted mt-1" style="font-size:10px;"><t t-esc="line.product_id.qty_available"/> disp.</div>
                    </div>
                    <div class="col-3 text-end">
                    <span class="fw-bold" style="font-size:14px;">
                      $<t t-esc="'%.2f' % ((line.product_id.discounted_price or line.product_id.list_price) * line.product_uom_qty)"/>
                    </span>
                    </div>
                  </div>
                  </t>
                </t>
              </div>
              <!-- Pie: envío, total y botón -->
              <div class="card-footer bg-white border-0 pt-4 pb-4">
                <div class="row align-items-center">
                  <div class="col-md-6 col-12 mb-2 mb-md-0">
                    <t t-if="order.partner_shipping_id">
                      <div class="text-primary" style="font-size:15px;">
                        Envío a: 
                        <span class="d-inline-block" style="max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                          <t t-esc="order.partner_shipping_id.contact_address_complete"/>
                        </span>
                        <a class="ms-1" data-bs-toggle="collapse" href="#fullAddressCollapse" role="button" aria-expanded="false" aria-controls="fullAddressCollapse">
                          <i class="fa fa-chevron-down small"></i>
                        </a>
                        <div class="collapse" id="fullAddressCollapse">
                          <div class="mt-1">
                            <span t-field="order.partner_shipping_id.contact_address_complete" t-options="{}" />
                          </div>
                        </div>
                      </div>
                    </t>
                  </div>
                  <div class="col-md-3 col-6 text-end">
                    <div class="fw-semibold" style="font-size:16px;">
                      Total: $
                        <t t-set="subtotal" t-value="sum((line.product_id.discounted_price if line.product_id.discounted_price else line.product_id.list_price) * line.product_uom_qty for line in order.order_line)"/>
                        <t t-esc="'%.2f' % subtotal"/>
                    </div>
                  </div>
                  <div class="col-md-3 col-6 text-end">
                    <a href="/shop/checkout" class="btn btn-primary px-4">Continuar compra</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </t>
    </xpath>
  </template>
</odoo>
