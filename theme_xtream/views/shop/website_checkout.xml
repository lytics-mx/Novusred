<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="delivered_template" name="Delivered and Pending Products">
        <t t-call="website.layout">
            <div class="container mt-5">
                <t t-if="delivered_products or pending_products">
                    <h2 class="mb-4" style="font-size:22px;">Compras</h2>
                </t>

                <!-- Buscador y filtrado -->
                <div class="d-flex align-items-center mb-4" style="gap: 24px;">
                    <form method="get" action="/delivered_products" class="d-flex align-items-center" style="gap: 12px;">
                        <div class="input-group" style="background: #d3d3d3; border-radius: 20px; padding: 0 12px; height: 40px; align-items: center;">
                            <span class="input-group-text bg-transparent border-0" style="padding-right: 0;">
                                <i class="fa fa-search" style="color: #222;"></i>
                            </span>
                            <input type="text" name="search" t-att-value="search" placeholder="Buscar..." class="form-control border-0 bg-transparent" style="box-shadow: none; font-family: 'Questrial', sans-serif; font-size: 15px; width: 200px;" />
                        </div>
                        <div class="input-group" style="background: #d3d3d3; border-radius: 20px; padding: 0 12px; height: 40px; align-items: center;">
                            <span class="input-group-text bg-transparent border-0" style="padding-right: 0;">
                                <i class="fa fa-filter" style="color: #222;"></i>
                            </span>
                            <select name="filter_state" class="form-select border-0 bg-transparent" style="box-shadow: none; font-family: 'Questrial', sans-serif; font-size: 15px; width: 120px;"
                                onchange="this.form.submit()">
                                <option value="all" t-att-selected="filter_state == 'all'">Todas</option>
                                <option value="assigned" t-att-selected="filter_state == 'assigned'">En camino</option>
                                <option value="done" t-att-selected="filter_state == 'done'">Entregado</option>
                            </select>
                        </div>
                    </form>
                    <p class="mb-0" style="font-family: 'Questrial', sans-serif; font-size: 15px; color: #222;"><t t-esc="product_count"/> Compras</p>
                </div>

                <div class="row">
                    <!-- Mensaje si no hay productos -->
                    <t t-if="not delivered_products and not pending_products">
                        <t t-if="filter_state != 'all'">
                            <div class="col-12 text-center">
                                <div class="card p-4 shadow-sm">
                                    <h4 class="mb-3">No tienes ningún pedido en el estado seleccionado</h4>
                                    <p class="mb-4">Por favor intenta con otro filtro o revisa tus compras.</p>
                                </div>
                            </div>
                        </t>
                        <t t-elif="search">
                            <div class="col-12 text-center">
                                <div class="card p-4 shadow-sm">
                                    <h4 class="mb-3">No se encontraron coincidencias</h4>
                                    <p class="mb-4">No hay productos que coincidan con tu búsqueda.</p>
                                </div>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="col-12 text-center">
                                <div class="card p-4 shadow-sm">
                                    <h4 class="mb-3">No tienes compras aún</h4>
                                    <p class="mb-4">Por favor navega por nuestro catálogo y encuentra productos de Odoo que te interesen.</p>
                                    <a href="/subcategory" class="btn btn-primary">Ir al catálogo</a>
                                </div>
                            </div>
                        </t>
                    <div style="height: 45px;"></div>    
                    </t>

                    <!-- Productos entregados -->
                    <t t-foreach="delivered_products" t-as="product">
                        <t t-if="product['state'] == 'done'">
                            <div class="col-12 mb-3">
                                <div class="card p-3 shadow-sm" style="background-color:rgb(255, 255, 255); border: none;">
                                    <!-- Fecha de compra -->
                                    <div class="d-flex flex-column align-items-start">
                                        <p class="mb-0" style="font-size: 16px; color: #000;">
                                            <t t-esc="product['purchase_date']"/>
                                        </p>
                                    </div>
                                    <!-- Imagen del producto -->
                                    <div class="d-flex flex-row align-items-center mt-1">
                                        <div class="me-3" style="flex: 0 0 100px;">
                                            <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded" style="width: 100px; height: auto;" />
                                        </div>
                                        <!-- Detalles del producto -->
                                        <div class="flex-grow-1 me-3">
                                            <p class="mb-1" style="color: #FF5207; font-size: 16px;">
                                                <t t-esc="product['purchase_date']"/>
                                            </p>
                                            
                                            <p class="mb-1" style="color: #000; font-size: 16px;">Entregado el <t t-esc="product['delivery_date']"/></p>
                                            <!-- Envío gratis -->
                                            <t t-if="product.get('free_shipping')">
                                                <p class="mb-1" style="color: #FF5207; font-size: 18px; font-style: italic; font-weight: bold;">
                                                    Envío gratis
                                                </p>
                                            </t>                                            
                                            
                                            <p class="text-muted mb-1">
                                                <t t-esc="product['product_name'][:100] + ('...' if len(product['product_name']) > 113 else '')"/>
                                            </p>

                                            <p class="text-muted"><t t-esc="product['quantity']"/> Unidad</p>                                
                                        </div>
                                        <!-- Enviar mensaje -->
                                        <div class="me-3">
                                            <a href="#" class="btn btn-link text-primary" style="font-size:16px; font-family:'Questrial', sans-serif;">Enviar mensaje</a>
                                        </div>
                                        <!-- Botones -->
                                        <div class="d-flex flex-column" style="min-width: 150px;">
                                            <a t-att-href="'/product_details/%d/%s' % (product['product_id'], product['picking_origin'])"
                                               class="btn mb-2"
                                               style="background-color: #3483FA; border: none; color: #fff; font-size: 16px; font-family: 'Questrial', sans-serif; border-radius: 8px; padding: 10px 24px; box-shadow: 0 2px 8px rgba(52,131,250,0.15); text-align: center;">
                                                Ingresar
                                            </a>

                                            <button type="button" class="btn" id="bundle-buy-now" 
                                                    t-att-href="'/shop/product/' + str(product['template_id'])"
                                                    style="width:100%; height:48px; border-radius:6px; background:#a8ccff; color:#1757e6; border:none; font-weight:500; font-size:18px; letter-spacing:0.5px; font-family:'Questrial', sans-serif; margin-top: 10px;">
                                                Volver a comprar
                                            </button>                                    
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>

                    <!-- Productos pendientes -->
                    <t t-foreach="pending_products" t-as="product">
                        <t t-if="product['state'] != 'done' and product['state'] != 'draft'">
                            <div class="col-12 mb-3">
                                <div class="card p-3 shadow-sm" style="background-color:rgb(255, 255, 255); border: none;">
                                    <!-- Fecha de compra -->
                                    <div class="d-flex flex-column align-items-start">
                                        <p class="mb-0" style="font-size: 16px; color: #000;">
                                            <t t-esc="product['purchase_date']"/>
                                        </p>
                                    </div>
                                    <!-- Imagen del producto -->
                                    <div class="d-flex flex-row align-items-center mt-1">
                                        <div class="me-3" style="flex: 0 0 100px;">
                                            <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded" style="width: 100px; height: auto;" />
                                        </div>
                                        <!-- Detalles del producto -->
                                        <div class="flex-grow-1 me-3">
                                            <p class="mb-1" style="color: #FF5207; font-size: 16px;">En camino</p>
                                    
                                        <!-- Estado de fecha estimada de entrega -->
                                            <p class="mb-1" style="color: #000; font-size: 16px;">
                                                <t t-esc="product['deadline_date']"/>
                                            </p>
                                        <!-- Envío gratis -->
                                            <t t-if="product.get('free_shipping')">
                                                <p class="mb-1" style="color: #FF5207; font-size: 18px; font-style: italic; font-weight: bold;">
                                                    Envío gratis
                                                </p>
                                            </t>
                                            <p class="text-muted mb-1">
                                                <t t-esc="product['product_name'][:100] + ('...' if len(product['product_name']) > 113 else '')"/>
                                            </p>
                                            <p class="text-muted"><t t-esc="product['quantity']"/> Unidad</p>                                
                                        </div>
                                        <!-- Enviar mensaje -->
                                        <div class="me-3">
                                            <a href="#" class="btn btn-link text-primary" style="font-size:16px; font-family:'Questrial', sans-serif;">Enviar mensaje</a>
                                        </div>
                                        <!-- Botones -->
                                        <div class="d-flex flex-column" style="min-width: 150px;">
                                            <a t-att-href="'/product_details/%d/%s' % (product['product_id'], product['picking_origin'])"
                                               class="btn mb-2"
                                               style="background-color: #3483FA; border: none; color: #fff; font-size: 16px; font-family: 'Questrial', sans-serif; border-radius: 8px; padding: 10px 24px; box-shadow: 0 2px 8px rgba(52,131,250,0.15); text-align: center;">
                                                Ingresar
                                            </a>                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>
                    <div style="height: 45px;"></div>
                </div>
            </div>
        </t>
    </template>
</odoo>