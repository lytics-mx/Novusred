<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="delivered_template" name="Delivered and Pending Products">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h2 class="mb-4">Mis Compras</h2>

                <!-- Buscador y filtrado -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <form method="get" action="/delivered_products" class="d-flex">
                        <input type="text" name="search" t-att-value="search" placeholder="Buscar por nombre o modelo..." class="form-control me-2" style="width: 300px;" />
                        <select name="filter_state" class="form-select me-2" style="width: 150px;">
                            <option value="all" t-att-selected="filter_state == 'all'">Todos</option>
                            <option value="waiting" t-att-selected="filter_state == 'waiting'">Alistándose</option>
                            <option value="assigned" t-att-selected="filter_state == 'assigned'">En camino</option>
                            <option value="done" t-att-selected="filter_state == 'done'">Entregado</option>
                        </select>
                        <button type="submit" class="btn btn-primary">Filtrar</button>
                    </form>
                    <p class="mb-0">Total de compras: <strong><t t-esc="product_count"/></strong></p>
                </div>

                <div class="row">
                    <!-- Mensaje si no hay productos -->
                    <t t-if="not delivered_products and not pending_products">
                        <div class="col-12 text-center">
                            <div class="card p-4 shadow-sm" style="background-color:rgb(255,255,255); border:none;">
                                <h4 class="mb-3">No tienes compras aún</h4>
                                <p class="mb-4">Por favor navega por nuestro catálogo y encuentra productos de Odoo que te interesen.</p>
                                <a href="/subcategory" class="btn btn-primary">Ir al catálogo</a>
                            </div>
                        </div>
                    </t>

                    <!-- Productos entregados -->
                    <t t-foreach="delivered_products" t-as="product">
                        <t t-if="product['state'] == 'done'">
                            <div class="col-12 mb-3">
                                <div class="card p-3 shadow-sm" style="background-color:rgb(255, 255, 255); border: none;">
                                    <div class="d-flex flex-row align-items-center">
                                        <div class="me-3" style="flex: 0 0 100px;">
                                            <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded" style="width: 100px; height: auto;" />
                                        </div>
                                        <div class="flex-grow-1">
                                            <h5 class="mb-1"><t t-esc="product['product_name']"/></h5>
                                            <p class="mb-1">Entregado el <t t-esc="product['delivery_date']"/></p>
                                            <p class="mb-1">Cantidad: <t t-esc="product['quantity']"/> unidad(es)</p>
                                            <t t-if="product.get('free_shipping')">
                                                <p class="mb-1" style="color: #FF5207; font-size: 18px; font-style: italic; font-weight: bold;">
                                                    Envío gratis
                                                </p>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>

                    <!-- Productos pendientes -->
                    <t t-foreach="pending_products" t-as="product">
                        <t t-if="product['state'] != 'done'">
                            <div class="col-12 mb-3">
                                <div class="card p-3 shadow-sm" style="background-color:rgb(255, 255, 255); border: none;">
                                    <div class="d-flex flex-row align-items-center">
                                        <div class="me-3" style="flex: 0 0 100px;">
                                            <img t-att-src="product['image_url']" alt="Imagen producto" class="img-fluid rounded" style="width: 100px; height: auto;" />
                                        </div>
                                        <div class="flex-grow-1">
                                            <h5 class="mb-1"><t t-esc="product['product_name']"/></h5>
                                            <p class="mb-1">Estado: <t t-esc="product['state']"/></p>
                                            <p class="mb-1">Fecha límite: <t t-esc="product['deadline_date']"/></p>
                                            <p class="mb-1">Cantidad: <t t-esc="product['quantity']"/> unidad(es)</p>
                                            <t t-if="product.get('free_shipping')">
                                                <p class="mb-1" style="color: #FF5207; font-size: 18px; font-style: italic; font-weight: bold;">
                                                    Envío gratis
                                                </p>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>
                </div>
            </div>
        </t>
    </template>
</odoo>